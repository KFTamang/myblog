+++
image = ""
tags = [
 "倒立振子",
]

title = "ギアボックスとモータ駆動系の製作"
description = ""
googleAnalytics = "UA-83537418-2"
date = "2019-04-21T12:49:27+09:00"
author = "KFTamang"
categories = [
  "Tech",
]
subtitle = ""
copyright = "KFTamang All rights reserved"
+++


# 倒立振子製作にむけて

倒立振子（とうりつしんし）とは、棒の先に重りをつけた振子を逆さに立てた系のことです。
当然そのままでは倒れてしまいますが、制御を加えることで逆立ちを維持させることができます。
フィードバック制御の課題としてよく取り上げられる題材であり、わたしはArduinoの練習ということで製作してみたいと思います。


# 今回の内容

倒立振子には制御を行う演算系と、実際の制御を行う機械系が必要になります。
今回は機械系としてDCモータでタイヤを駆動する1次元系にしました。

以下に部品のリストを示します。

* [3速クランクギアボックスセット - タミヤ](https://www.tamiya.com/japan/products/70093/index.html)
* [DCモータ FA-130 - タミヤ](https://www.tamiya.com/japan/products/94380/index.html)
* [オフロードタイヤセット - タミヤ](https://www.tamiya.com/japan/products/70096/index.html)
* [ＤＲＶ８８３５使用ステッピング＆ＤＣモータドライバモジュール - 秋月電子](http://akizukidenshi.com/catalog/g/gK-09848/)


モータは親の顔よりよく見たミニ４駆用DCモータです。これはマブチモータ互換品であり、マブチ製品の型番はFA-130RAというようです。
性能表は[ここ](https://product.mabuchi-motor.co.jp/detail.html?id=9)にあります。

![モータ性能表](/images/ScreenShot2019-04-21at131244.png)

これを見ると、電圧は1.5-3.0Vのようです。ネット上でロボコンなどの記事を見ると過電圧をかけることも可能なようですが、
定格に準拠したいと思います。

今回はこのモータを秋月のドライバICキットで動かすところまでやりたいと思います。



# ギアボックス、モータの組み立てと動作確認

説明書に沿って組み立てます。ギア比は中速(1/58.2減速)を選びました。
モータを3Vに接続してのテストしました。




# ドライバICによるモータ制御

秋月のモータドライバICキットでモータをコントロールできるかテストします。
今回購入したキットにはDRV8835が使用してあります。
この[DRV8835のデータシート](http://akizukidenshi.com/download/ds/ti/drv8835.pdf)を見ると、
定格1.5Aのチャンネルが二つあり、並列に繋げることで最大3Aまでドライブできるようです。
FA-130の性能表を見ると無負荷(NO LOAD)で0.20A、静止時(STALL)で2.20Aの電流が流れるとのことです。
本番では偶然壁にぶつかってしまうこともあると思うので2chを並列に接続しますが、
今のテストでは1chだけでいいでしょう。

![DRV8835](/images/ScreenShot2019-04-21at144952.png)


ブレッドボードに動作テスト用の回路を組みます。
DRV8835に電源を与えて入力の2つの入力のロジックレベルを変えてやると、
表にしたがって回転方向が変化します。

![ブレッドボードテスト](/images/P_20190421_155506_vHDR_Auto.jpg)
ブレッドボードでテストをしている様子。
モバイルバッテリーから電圧を3.3Vへ落としてICへ供給している。反対側にはモータ駆動用の電池が繋がっている。


入出力の対応には2種類のモードがあり、それぞれIN/INモードとPHASE/ENABLEモードと呼ばれています。
IN/INモードではCoast(空転)が使えますが、ReverseのときにON/OFFがややこしくなります。
その点、PHASE/ENABLEモードではCoastが使えない代わりに、ReverseでもON/OFFの操作がForwardと同じになります。

倒立振子の運動を考えると、常に制御していないと倒れてしまうことからCoastは必要ない代わりに、
運動は前進と後進が対称です。
PWMで速度の調整を行いたいことから、動作モードはPHASE/ENABLEが適していることがわかりました。


![ロジック表](/images/ScreenShot2019-04-21at154930.png)
入力と出力の対応表。


次回はArduinoを用いてPWMでの回転速度制御を行う予定です。



