+++
image = ""
tags = [
 "マイクロマウス",
]

title = "マイクロマウスはじめました[マイクロマウス]"
description = "マイクロマウスの開発を始めました。書籍「苦しんで作るマイクロマウス　前編」に沿って機体を製作しました。モーターSCR13-2005、ピニオンギア、壁センサーLBR-127HLDについて解説します。"
googleAnalytics = "UA-83537418-2"
date = "2021-02-10T18:17:27+09:00"
author = "KFTamang"
categories = [
  "Tech",
]
subtitle = ""
copyright = "KFTamang All rights reserved"
+++

# マイクロマウスはじめました
倒立振子に次ぐ電子工作としてマイクロマウスを初めてみました。
きっかけはAmazonで「苦しんで作るマイクロマウス 前編」という本を見かけたからです。（Kindle版へのリンクは[こちら](https://www.amazon.co.jp/%E8%8B%A6%E3%81%97%E3%82%93%E3%81%A7%E3%81%A4%E3%81%8F%E3%82%8B%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%83%9E%E3%82%A6%E3%82%B9-%E5%89%8D%E7%B7%A8-takeyuta-ebook/dp/B072FF7VCJ)）

Kindle版のみの自主出版の本で、マイクロマウスのハードウェアの作り方が細かく具体的に書いてあります。電子書籍はこのような自主出版ができるのが素晴らしいですね。
ちなみに2021年2月現在、残念ながら後編のソフトウェア編はまだ出版されていないようです。これを一人で書ききるのは相当なモチベーションと時間が必要でしょうから仕方ないかもしれませんが、
続編を期待しながら待ちたいと思います。

とはいえ続編を待ってはいられないので、ソフトウェアの制作をこれから進めていきたいと思います。

ソフトウェアのGitHubレポジトリはこちら→[https://github.com/KFTamang/Bontaco](https://github.com/KFTamang/Bontaco)

## ハードウェアについて

実は機体のハードウェアは完成しているので、本記事では完成した機体について述べていきたいと思います。

部品表はマウス本に載っていますが、執筆当時から数年たち、ディスコンとなって手に入りにくい部品がいくつかありました。
そこで手に入れやすい部品を置き換えた部品表を[こちらのGoogleスプレッドシート](https://docs.google.com/spreadsheets/d/1F_0-vw71zmjUdmgELo2EZzASPPmHTeYoibJGBpWsLXo/edit?usp=sharing)に公開しています。
（執筆者のかたに公開していいか聞いたものの返事がまだもらえておらず、他の方も公開していたので勝手に問題なしと判断しました。問題あればご連絡ください。）

マイクロマウス Bontaco号↓
![マイクロマウス Bontaco号](/images/PXL_20210211_032633763.jpg)

### モーター SCR13-2005
部品代の半分以上はロータリーエンコーダ付きのモーターです。
おそらくこれを買う決断が、最初の山場になるでしょう。2個で4万円します。一度買ったらとにかくいつか完成させましょう。
このモーターはシチズンマイクロさんのホームページに載っている問い合わせ用メールアドレス（motor@micro.citizen.co.jp）に直接モーターを買いたい旨を連絡して購入しました。
最初のメールを送ってからモーターが到着するまでに、自分の場合は2か月かかりました。

モーター周辺のアップ↓
![モーター](/images/PXL_20210211_032656629_motor.jpg)

### ピニオンギア
モーターのシャフトに取り付ける小さなギアのことです。樹脂製だと壊れたりとトラブルのもとになりやすいそうなので、真鍮製のものが推奨されています。
ただこのモーターのシャフト径は1.5mmと、もっとも出回っているホビー用タミヤモーターと異なります。
なので真鍮製のピニオンギアの入手先は限られます。マウス本ではヨーロッパ（たぶんポーランド）のKKPMOという通販サイトから購入するよう書いてありました。
自分も最初はそれに従って購入しましたが、半年以上経ってもいまだに届きません。メールも返ってきません。金返せという感じですが、3000円くらいなので泣き寝入りします。
結局、中国の通販サイトであるAliExpressで購入しました。今はドローン用にギアの品ぞろえが良くなっているみたいです。

ところがまだ問題があり、購入したギアは圧入用に内径が1.5mmピッタリになっています。しかしモーターはロータリーエンコーダ付きで、シャフトが反対側に飛び出していません。
シチズンマイクロの方に聞いたところ、圧入は対応していないので、接着剤でつけてくれとのこと。危うく4万円のモーターを破壊することろでした。くわばらくわばら。

なので結局手持ちのピンセットで真鍮のギアの内側を削り、内径を広げました。これでようやくシャフトにギアがつけられました。接着剤は金属用の強力接着剤であるメタルロックを使用しました。

AliExpressで買った真鍮製のピニオンギア↓
![AliExpressで買った真鍮製のピニオンギア](/images/PXL_20210211_035654662.jpg)

### 壁センサー LBR-127HLD
マウス本では壁のセンサーとしてTSL262Rを使用しています。これはフォトダイオードとアンプを組み合わせた赤外―可視光の受光センサーです。これが使えれば良かったのですが、TSL262Rは残念ながらディスコンになっています。
そこで壁センサーにLBR-127HLD（[秋月電子リンク](http://akizukidenshi.com/catalog/g/gP-04500/)）を使用しました。
LBR-127HLDは赤外線LEDとフォトトランジスタがパッケージになっています。
TSL262Rと違い受光素子がフォトダイオードなので出力は電流です。よってマイコンのADCで読み取るために、電圧へ変換する必要があります。
このための抵抗値によってセンサーの感度が変化します。
いくつか値を変えながら試したところ、5 ㎝先の壁を検知するためには抵抗値が1MΩ程度必要です。
回路図↓でのR16です。
![壁センサーの回路図](/images/wall_sensor.PNG)

1MΩのチップ抵抗は部品表に入っておらず購入していなかったので、手持ちのアキシャル部品の抵抗を無理やりはんだ付けしました。
今ははんだで固定されているだけなので、そのうち弾性接着剤などで固定しないと不具合の原因になりそうです。

黒い四角のLBR-127HLDと無理やり実装したアキシャルの金属皮膜抵抗↓
![壁センサーの画像](/images/PXL_20210211_032656629_sensor.jpg)

## ソフトウェア開発環境
最初はソフトウェア開発にルネサスが提供しているIDEのHigh-performance Embedded Workshop(HEW)を使っていました。
しかし補完はできない（調べればできるだろうけど調べてない）、gitは使えないと正直使いづらいので[HEWプロジェクトをVSCodeで扱う - Qiita](https://qiita.com/BonyChops/items/bcf39f2decc4f03a63df)を参考にしてVSCodeへ移行しました。
使いやすい！
これを使って開発をしていきます。

